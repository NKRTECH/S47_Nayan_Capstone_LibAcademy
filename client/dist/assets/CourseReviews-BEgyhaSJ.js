import{k as V,m as W,s as P,_ as w,r as a,o as q,p as O,j as e,q as G,v as J,$ as K,c,a as j,T as l,B as M}from"./index-f7-2eSJk.js";import{C as Q}from"./Container-CUuuXKaa.js";import{R as X,C as Y}from"./Rating-mU1j8mJx.js";import{I as u}from"./IconButton-5JQqtBZk.js";import{c as v}from"./Modal-DyP9q9P1.js";import{T as I}from"./TextField-B4aAAyhF.js";import{C as Z}from"./Card-BKKX2NPm.js";function ee(s){return V("MuiCardActions",s)}W("MuiCardActions",["root","spacing"]);const te=["disableSpacing","className"],se=s=>{const{classes:r,disableSpacing:n}=s;return J({root:["root",!n&&"spacing"]},ee,r)},re=P("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,r)=>{const{ownerState:n}=s;return[r.root,!n.disableSpacing&&r.spacing]}})(({ownerState:s})=>w({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),ne=a.forwardRef(function(r,n){const i=q({props:r,name:"MuiCardActions"}),{disableSpacing:y=!1,className:h}=i,d=O(i,te),m=w({},i,{disableSpacing:y}),g=se(m);return e.jsx(re,w({className:G(g.root,h),ownerState:m,ref:n},d))}),oe=v(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),ae=v(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),T=v(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),ie=v(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),xe=({courseId:s})=>{const r="https://s47-nayan-capstone-libacademy-7yf9.onrender.com/api",[n,i]=a.useState([]),[y,h]=a.useState(0),[d,m]=a.useState(0),[g,S]=a.useState(!1),[b,E]=a.useState({comment:""}),[$,R]=a.useState(null),[k,A]=a.useState(""),_=localStorage.getItem("token"),x=_?K(_):"",f=x?x.role:"user",p=x?x[`${f}Id`]:"";a.useEffect(()=>{C(),B()},[]);const C=async()=>{try{const t=await c.get(`${r}/courses/${s}/reviews`);i(t.data.reviews)}catch(t){console.error("Error fetching reviews:",t)}},B=async()=>{try{const t=await c.get(`${r}/courses/${s}/ratings/${p}`);h(t.data.rating.rating||0),m(t.data.rating.rating||0)}catch(t){console.error("Error fetching user rating:",t)}},z=async()=>{try{await c.post(`${r}/courses/${s}/reviews`,{learnerId:p,comment:b.comment}),C(),E({comment:""})}catch(t){console.error("Error adding review:",t)}},L=async(t,o)=>{try{await c.put(`${r}/courses/${s}/reviews/${t}`,{comment:o}),C(),R(null)}catch(H){console.error("Error editing review:",H)}},U=async t=>{try{await c.delete(`${r}/courses/${s}/reviews/${t}`),C()}catch(o){console.error("Error deleting review:",o)}},D=t=>{g&&m(t)},N=async()=>{try{await c.post(`${r}/courses/${s}/ratings`,{learnerId:p,rating:d}),h(d),S(!1),B()}catch(t){console.error("Error submitting rating:",t)}},F=()=>{S(!0)};return e.jsx(Q,{maxWidth:"md",children:e.jsxs(j,{sx:{backgroundColor:"#2e3b4e",padding:3,borderRadius:2,color:"#ffffff"},children:[e.jsx(l,{variant:"h5",gutterBottom:!0,children:"Course Reviews and Ratings"}),f==="learner"&&e.jsxs(j,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Rate This Course"}),e.jsx(X,{name:"rating",value:d,onChange:(t,o)=>D(o),sx:{color:"#ffd700"},readOnly:!g}),g?e.jsx(M,{variant:"contained",color:"primary",onClick:N,sx:{marginTop:2},children:"Submit Rating"}):e.jsx(u,{onClick:F,sx:{marginLeft:2,color:"#ffd700"},children:e.jsx(T,{})})]}),f==="learner"&&e.jsxs(j,{mb:4,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Add a Review"}),e.jsx(I,{label:"Comment",multiline:!0,rows:2,value:b.comment,onChange:t=>E(o=>({...o,comment:t.target.value})),fullWidth:!0,margin:"normal",sx:{backgroundColor:"#ffffff",color:"#000000"}}),e.jsx(M,{variant:"contained",color:"primary",onClick:z,sx:{marginTop:2},children:"Submit Review"})]}),e.jsxs(j,{mb:4,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Reviews"}),n==null?void 0:n.map(t=>e.jsxs(Z,{variant:"outlined",sx:{marginBottom:2,backgroundColor:"#ffffff",color:"#000000"},children:[e.jsx(Y,{children:$===t._id?e.jsx(I,{fullWidth:!0,multiline:!0,rows:2,value:k,onChange:o=>A(o.target.value),sx:{backgroundColor:"#ffffff",color:"#000000"}}):e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"body2",children:t.comment}),e.jsxs(l,{variant:"caption",children:["Reviewed by: ",t.learnerId.firstName," on"," ",new Date(t.createdAt).toLocaleDateString()]})]})}),f==="learner"&&t.learnerId._id===p&&e.jsx(ne,{children:$===t._id?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:()=>L(t._id,k),children:e.jsx(ie,{})}),e.jsx(u,{onClick:()=>R(null),children:e.jsx(oe,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:()=>{R(t._id),A(t.comment)},children:e.jsx(T,{})}),e.jsx(u,{onClick:()=>U(t._id),children:e.jsx(ae,{})})]})})]},t._id))]})]})})};export{xe as C};

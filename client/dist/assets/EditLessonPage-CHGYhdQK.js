import{s as F,B as W,r as n,b as V,H as z,j as e,P as N,T as B,a as D,c as y}from"./index-f7-2eSJk.js";import{C as O}from"./Container-CUuuXKaa.js";import{A as H}from"./Alert-CQZzBUb_.js";import{T as l}from"./TextField-B4aAAyhF.js";import{C as P}from"./CircularProgress-C6SH9T4R.js";import"./styled-Cry4a1KF.js";import"./Modal-DyP9q9P1.js";import"./IconButton-5JQqtBZk.js";import"./useFormControl-N2H_Ek8d.js";const h="https://s47-nayan-capstone-libacademy-7yf9.onrender.com/api",_=F(O)(({theme:a})=>({marginTop:a.spacing(4),padding:a.spacing(3),backgroundColor:a.palette.background.paper,borderRadius:a.shape.borderRadius})),A=F(W)(({theme:a})=>({marginTop:a.spacing(2),marginRight:a.spacing(2)})),te=()=>{const[a,x]=n.useState(""),[v,j]=n.useState(""),[b,C]=n.useState(""),[S,T]=n.useState(""),[c,R]=n.useState(null),[p,k]=n.useState(""),[L,w]=n.useState(0),[m,r]=n.useState(!1),[E,f]=n.useState(""),I=V(),{lessonId:d}=z();n.useEffect(()=>{d&&(async()=>{var s,o,u,g;r(!0);try{const i=(await y.get(`${h}/lessons/fetchLessonById/${d}`)).data.lesson;x(i.title),j(i.content.text),C(((s=i.content.media[0])==null?void 0:s.alt)||""),T(((o=i.content.media[0])==null?void 0:o.description)||""),k(i.courseId),w(i.priority),r(!1)}catch($){f(((g=(u=$.response)==null?void 0:u.data)==null?void 0:g.message)||"Error fetching lesson"),r(!1)}})()},[d]);const q=async t=>{var o,u;t.preventDefault(),r(!0);const s=new FormData;s.append("title",a),s.append("text",v),s.append("alt",b),s.append("description",S),s.append("courseId",p),s.append("priority",L),c&&s.append("videoFile",c);try{await y.put(`${h}/lessons/update/${d}`,s,{headers:{"Content-Type":"multipart/form-data"}}),I(`/tutor/courses/${p}/lessons`)}catch(g){f(((u=(o=g.response)==null?void 0:o.data)==null?void 0:u.message)||"Error updating lesson")}finally{r(!1)}},U=async()=>{var t,s;if(window.confirm("Are you sure you want to delete this lesson?")){r(!0);try{await y.delete(`${h}/lessons/delete/${d}`),I(`/tutor/courses/${p}/lessons`)}catch(o){f(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||"Error deleting lesson")}finally{r(!1)}}};return e.jsxs(_,{component:N,children:[e.jsx(B,{variant:"h4",gutterBottom:!0,children:"Edit Lesson"}),E&&e.jsx(H,{severity:"error",children:E}),e.jsxs("form",{onSubmit:q,encType:"multipart/form-data",children:[e.jsx(l,{label:"Title",variant:"outlined",fullWidth:!0,value:a,onChange:t=>x(t.target.value),margin:"normal",required:!0}),e.jsx(l,{label:"Lesson text",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:v,onChange:t=>j(t.target.value),margin:"normal",required:!0}),e.jsx(l,{label:"Alt text for video",variant:"outlined",fullWidth:!0,value:b,onChange:t=>C(t.target.value),margin:"normal"}),e.jsx(l,{label:"Video description",variant:"outlined",fullWidth:!0,multiline:!0,rows:3,value:S,onChange:t=>T(t.target.value),margin:"normal"}),e.jsx(l,{label:"Order of lesson",variant:"outlined",fullWidth:!0,type:"number",value:L,onChange:t=>w(Number(t.target.value)),margin:"normal"}),e.jsx(l,{label:"Course ID",variant:"outlined",fullWidth:!0,value:p,margin:"normal",required:!0,InputProps:{readOnly:!0}}),e.jsxs(D,{mt:2,children:[e.jsx("input",{type:"file",onChange:t=>R(t.target.files[0]),accept:"video/*",style:{display:"none"},id:"video-upload"}),e.jsxs("label",{htmlFor:"video-upload",children:[e.jsx(W,{variant:"contained",component:"span",children:"Upload Video"}),c&&e.jsx(B,{variant:"body2",sx:{marginTop:1},children:c.name})]})]}),e.jsxs(D,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,children:[e.jsx(A,{variant:"contained",color:"primary",type:"submit",disabled:m,children:m?e.jsx(P,{size:24}):"Update Lesson"}),e.jsx(A,{variant:"contained",color:"secondary",onClick:U,disabled:m,children:m?e.jsx(P,{size:24}):"Delete Lesson"})]})]})]})};export{te as default};

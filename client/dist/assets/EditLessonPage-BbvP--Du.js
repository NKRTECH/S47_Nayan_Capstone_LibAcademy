import{s as F,B as W,r,b as V,H as z,j as e,P as N,T as B,a as D,c as h}from"./index-CMhKlQ9x.js";import{C as O}from"./Container-ODW-pUM5.js";import{A as H}from"./Alert-NbfKCkmU.js";import{T as l}from"./TextField-B8tTtmf-.js";import{C as P}from"./CircularProgress-DQ1vEl0j.js";import"./styled-Juhbs2Pg.js";import"./Modal-BEHYS6tq.js";import"./IconButton-BRZ8ioHV.js";import"./useFormControl-D9fy2Jgo.js";const x="http://localhost:3000/api",_=F(O)(({theme:a})=>({marginTop:a.spacing(4),padding:a.spacing(3),backgroundColor:a.palette.background.paper,borderRadius:a.shape.borderRadius})),A=F(W)(({theme:a})=>({marginTop:a.spacing(2),marginRight:a.spacing(2)})),te=()=>{const[a,y]=r.useState(""),[v,j]=r.useState(""),[b,C]=r.useState(""),[S,T]=r.useState(""),[c,R]=r.useState(null),[p,k]=r.useState(""),[L,w]=r.useState(0),[m,n]=r.useState(!1),[E,f]=r.useState(""),I=V(),{lessonId:d}=z();r.useEffect(()=>{d&&(async()=>{var s,o,u,g;n(!0);try{const i=(await h.get(`${x}/lessons/fetchLessonById/${d}`)).data.lesson;y(i.title),j(i.content.text),C(((s=i.content.media[0])==null?void 0:s.alt)||""),T(((o=i.content.media[0])==null?void 0:o.description)||""),k(i.courseId),w(i.priority),n(!1)}catch($){f(((g=(u=$.response)==null?void 0:u.data)==null?void 0:g.message)||"Error fetching lesson"),n(!1)}})()},[d]);const q=async t=>{var o,u;t.preventDefault(),n(!0);const s=new FormData;s.append("title",a),s.append("text",v),s.append("alt",b),s.append("description",S),s.append("courseId",p),s.append("priority",L),c&&s.append("videoFile",c);try{await h.put(`${x}/lessons/update/${d}`,s,{headers:{"Content-Type":"multipart/form-data"}}),I(`/tutor/courses/${p}/lessons`)}catch(g){f(((u=(o=g.response)==null?void 0:o.data)==null?void 0:u.message)||"Error updating lesson")}finally{n(!1)}},U=async()=>{var t,s;if(window.confirm("Are you sure you want to delete this lesson?")){n(!0);try{await h.delete(`${x}/lessons/delete/${d}`),I(`/tutor/courses/${p}/lessons`)}catch(o){f(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||"Error deleting lesson")}finally{n(!1)}}};return e.jsxs(_,{component:N,children:[e.jsx(B,{variant:"h4",gutterBottom:!0,children:"Edit Lesson"}),E&&e.jsx(H,{severity:"error",children:E}),e.jsxs("form",{onSubmit:q,encType:"multipart/form-data",children:[e.jsx(l,{label:"Title",variant:"outlined",fullWidth:!0,value:a,onChange:t=>y(t.target.value),margin:"normal",required:!0}),e.jsx(l,{label:"Lesson text",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:v,onChange:t=>j(t.target.value),margin:"normal",required:!0}),e.jsx(l,{label:"Alt text for video",variant:"outlined",fullWidth:!0,value:b,onChange:t=>C(t.target.value),margin:"normal"}),e.jsx(l,{label:"Video description",variant:"outlined",fullWidth:!0,multiline:!0,rows:3,value:S,onChange:t=>T(t.target.value),margin:"normal"}),e.jsx(l,{label:"Order of lesson",variant:"outlined",fullWidth:!0,type:"number",value:L,onChange:t=>w(Number(t.target.value)),margin:"normal"}),e.jsx(l,{label:"Course ID",variant:"outlined",fullWidth:!0,value:p,margin:"normal",required:!0,InputProps:{readOnly:!0}}),e.jsxs(D,{mt:2,children:[e.jsx("input",{type:"file",onChange:t=>R(t.target.files[0]),accept:"video/*",style:{display:"none"},id:"video-upload"}),e.jsxs("label",{htmlFor:"video-upload",children:[e.jsx(W,{variant:"contained",component:"span",children:"Upload Video"}),c&&e.jsx(B,{variant:"body2",sx:{marginTop:1},children:c.name})]})]}),e.jsxs(D,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,children:[e.jsx(A,{variant:"contained",color:"primary",type:"submit",disabled:m,children:m?e.jsx(P,{size:24}):"Update Lesson"}),e.jsx(A,{variant:"contained",color:"secondary",onClick:U,disabled:m,children:m?e.jsx(P,{size:24}):"Delete Lesson"})]})]})]})};export{te as default};
